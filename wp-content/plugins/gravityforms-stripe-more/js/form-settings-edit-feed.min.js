function gfp_stripe_toggle_coupon_setting(){var e=jQuery("#gfp_stripe_type").val(),t=jQuery("#gfp_more_stripe_coupons_container"),_=jQuery("#gfp_more_stripe_coupons_apply_container");jQuery(this).is(":checked")?(t.show("slow"),"subscription"==e&&_.show("slow")):(t.hide("slow"),"subscription"==e&&_.hide("slow"))}function gfp_stripe_set_coupon_field_placeholder(){this.checked&&jQuery("#gfp_more_stripe_coupons_field").val("Select a field")}function gfp_stripe_toggle_metadata_fields(){var e=jQuery("#custom_metadata_fields");jQuery(this).is(":checked")?e.show("slow"):(e.hide("slow"),gfp_more_stripe_reset_metadata(null,GFP_Stripe_Rule.form,{form_fields:GFP_Stripe_Rule.form_fields}))}function gfp_stripe_clear_input_placeholder(){stripe_edit_feed_settings.metadata_key_name_placeholder==jQuery(this).val()&&jQuery(this).val("")}function gfp_stripe_add_input_placeholder(){""==jQuery(this).val()&&jQuery(this).val(stripe_edit_feed_settings.metadata_key_name_placeholder)}function gfp_more_stripe_after_select_type(e,t){jQuery("#stripe_free_trial_no_credit_card_container input:checked").prop("checked",!1),"subscription"==t?jQuery("#stripe_free_trial_no_credit_card_container").show():jQuery("#stripe_free_trial_no_credit_card_container").hide()}function gfp_more_stripe_invalid_creditcard_error(){var e=jQuery("#stripe_free_trial_no_credit_card_container").css("display");"undefined"!=typeof e&&"none"!==e&&jQuery("#gfp_more_stripe_free_trial_no_credit_card").prop("checked")&&(stripe_edit_feed_settings.show_invalid_creditcard_error=!1)}function gfp_more_stripe_reset_metadata(e,t,_){GFP_Stripe_Rule.metadata=[new gfp_stripe_metadata_option],GFP_Stripe_Rule.form=t,GFP_Stripe_Rule.form_fields=_.form_fields,gfp_stripe_create_custom_metadata_options()}function gfp_stripe_create_custom_metadata_options(){for(var e=GFP_Stripe_Rule.form,t=GFP_Stripe_Rule.metadata,_="",a=0;a<t.length;a++)_+='<div class="margin_vertical_10">',_+='<div class="metadataname">',_+='<div class="custom_metadataname">'+gfp_stripe_get_metadata_key_name_input(a,t[a])+"</div></div>",_+='<div class="metadatavalue"><select type="text" name="gfp_stripe_metadata_value_'+a+'" id="gfp_stripe_metadata_value_'+a+'" class="meta-value-select width-1">',_+=gfp_stripe_get_metadata_key_value_options(e,t[a].key_value)+"</select></div>",_+="<img src='"+stripe_edit_feed_settings.metadata_add_img_url+"' class='add_field_choice' title='"+stripe_edit_feed_settings.metadata_add_field_tooltip+"' alt='"+stripe_edit_feed_settings.metadata_add_field_tooltip+"' style='cursor:pointer;' onclick=\"gfp_stripe_insert_metadata_field("+(a+1)+", 'metadata');\" />",t.length>1&&(_+="<img src='"+stripe_edit_feed_settings.metadata_remove_img_url+"' title='"+stripe_edit_feed_settings.metadata_remove_field_tooltip+"' alt='"+stripe_edit_feed_settings.metadata_remove_field_tooltip+"' class='delete_field_choice' style='cursor:pointer;' onclick=\"gfp_stripe_delete_metadata_field("+a+", 'metadata');\" /></li>"),_+="</div>";jQuery("#custom_metadata_fields").html(_)}function gfp_stripe_get_metadata_key_value_options(e,t){var _=GFP_Stripe_Rule.form_fields,a='<option value=""></option>';for(i=0;i<_.length;i++)a+=_[i][0]==t?'<option value="'+_[i][0]+'" selected="selected">'+_[i][1]+"</option>":'<option value="'+_[i][0]+'">'+_[i][1]+"</option>";return a}function gfp_stripe_get_metadata_key_name_input(e,t){var _=""!=t.key_name?t.key_name:stripe_edit_feed_settings.metadata_key_name_placeholder;return str='<input type="text" name="gfp_stripe_custom_metadata_name_'+e+'" id="gfp_stripe_custom_metadata_name_'+e+'" class="width-1" value="'+_+'" maxlength="40" />'}function gfp_stripe_insert_metadata_field(e,t){GFP_Stripe_Rule[t].splice(e,0,new gfp_stripe_metadata_option),gfp_stripe_create_custom_metadata_options()}function gfp_stripe_delete_metadata_field(e,t){GFP_Stripe_Rule[t].splice(e,1),gfp_stripe_create_custom_metadata_options()}function gfp_stripe_metadata_option(){this.key_name="",this.key_value="",this.custom=!1}function gfp_stripe_save_metadata(){for(var e=GFP_Stripe_Rule.metadata,t=0;t<e.length;t++)e[t].custom=!0,e[t].key_name=jQuery("#gfp_stripe_custom_metadata_name_"+t).val(),e[t].key_value=jQuery("#gfp_stripe_metadata_value_"+t).val();GFP_Stripe_Rule.metadata=e;var _=jQuery.toJSON(e);jQuery("#gfp_stripe_metadata").val(_)}var GFP_Stripe_Rule={form:form,form_fields:stripe_edit_feed_settings.form_fields,metadata:stripe_edit_feed_settings.metadata};jQuery(document).ready(function(){jQuery(document).on("gfp_stripe_rule_select_type",gfp_more_stripe_after_select_type),jQuery(document).on("gfp_stripe_rule_invalid_creditcard_error",gfp_more_stripe_invalid_creditcard_error);var e=jQuery("#gfp_more_stripe_enable_coupons");e.change(gfp_stripe_set_coupon_field_placeholder),e.click(gfp_stripe_toggle_coupon_setting),jQuery(document).on("stripeFormSelected",gfp_more_stripe_reset_metadata),0==stripe_edit_feed_settings.metadata.length&&(GFP_Stripe_Rule.metadata=[new gfp_stripe_metadata_option]),0!==stripe_edit_feed_settings.form.length&&gfp_stripe_create_custom_metadata_options(),jQuery(".metadataname input, .metadatavalue select").on("change",function(){gfp_stripe_save_metadata()}),jQuery("#gfp_stripe_edit_feed_form").submit(gfp_stripe_save_metadata);var t=jQuery(".custom_metadataname").find("input");t.on("focus",gfp_stripe_clear_input_placeholder),t.on("blur",gfp_stripe_add_input_placeholder),jQuery("#gfp_more_stripe_enable_metadata").click(gfp_stripe_toggle_metadata_fields)});
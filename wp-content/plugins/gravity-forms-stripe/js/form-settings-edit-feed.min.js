function SelectType(e){jQuery("#stripe_field_group").slideUp(),jQuery('#stripe_field_group input[type="text"], #stripe_field_group select').val(""),jQuery("#stripe_field_group input:checked").prop("checked",!1),jQuery(document).trigger("gfp_stripe_rule_select_type",e),e?(jQuery("#stripe_form_container").slideDown(),jQuery("#gfp_stripe_form").val("")):jQuery("#stripe_form_container").slideUp()}function SelectForm(e,t,i){if(!t)return void jQuery("#stripe_field_group").slideUp();jQuery("#stripe_wait").show(),jQuery("#stripe_field_group").slideUp();var r={action:"gfp_select_stripe_form",gfp_select_stripe_form:stripe_edit_feed_settings.select_form_nonce,type:e,form_id:t,setting_id:i};return jQuery.post(ajaxurl,r,function(e){!0===e.success?EndSelectForm(e.data.form,e.data.customer_fields,e.data.endselectform_args):(jQuery("#stripe_wait").hide(),alert(stripe_edit_feed_settings.select_form_error_message))}),!0}function EndSelectForm(e,t,i){if(form=e,"null"!=typeof i)var r=i.populate_field_options,o=i.post_update_action,n=i.show_fields;else var r="",o="",n="";var s=jQuery("#gfp_stripe_type").val();if(jQuery(".gfp_stripe_invalid_form").hide(),("product"==s||"subscription"==s||"update-subscription"==s)&&0==GetFieldsByType(["product"]).length)return jQuery("#gfp_stripe_invalid_product_form").show(),void jQuery("#stripe_wait").hide();if(("product"==s||"subscription"==s||"update-billing"==s)&&0==GetFieldsByType(["creditcard"]).length&&(jQuery(document).trigger("gfp_stripe_rule_invalid_creditcard_error"),"undefined"==typeof stripe_edit_feed_settings.show_invalid_creditcard_error||!0===stripe_edit_feed_settings.show_invalid_creditcard_error))return jQuery("#gfp_stripe_invalid_creditcard_form").show(),void jQuery("#stripe_wait").hide();if(jQuery(".stripe_field_container").hide(),r.length>0)for(var d,l=0;l<r.length;l++)(d=new Function("type",r[l]))(s);jQuery("#stripe_customer_fields").html(t);var _=GetFieldsByType(["post_title","post_content","post_excerpt","post_category","post_custom_field","post_image","post_tag"]);if(o.length>0)for(var d,l=0;l<o.length;l++)(d=new Function("type","post_fields",o[l]))(s,_);else jQuery("#gfp_stripe_update_post").attr("checked",!1),jQuery("#stripe_post_update_action").hide();if(jQuery(document).trigger("stripeFormSelected",[form,i]),jQuery("#gfp_stripe_conditional_enabled").attr("checked",!1),SetStripeCondition("",""),jQuery("#stripe_field_container_"+s).show(),n.length>0)for(var d,l=0;l<n.length;l++)(d=new Function("type",n[l]))(s);jQuery("#stripe_field_group").slideDown(),jQuery("#stripe_wait").hide()}function GetFieldsByType(e){for(var t=new Array,i=0;i<form.fields.length;i++)IndexOf(e,form.fields[i].type)>=0&&t.push(form.fields[i]);return t}function IndexOf(e,t){for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1}function SetStripeCondition(e,t){jQuery("#gfp_stripe_conditional_field_id").html(GetSelectableFields(e,20));var i=jQuery("#gfp_stripe_conditional_field_id").val(),r=jQuery("#gfp_stripe_conditional_enabled").attr("checked");i?(jQuery("#gfp_stripe_conditional_message").hide(),jQuery("#gfp_stripe_conditional_fields").show(),jQuery("#gfp_stripe_conditional_value_container").html(GetFieldValues(i,t,20)),jQuery("#gfp_stripe_conditional_value").val(t)):(jQuery("#gfp_stripe_conditional_message").show(),jQuery("#gfp_stripe_conditional_fields").hide()),r||jQuery("#gfp_stripe_conditional_container").hide()}function GetFieldValues(e,t,i){if(!e)return"";var r="",o=GetFieldById(e);if(!o)return"";var n=!1;if("post_category"==o.type&&o.displayAllCategories)r+=stripe_edit_feed_settings.post_categories;else if(o.choices){r+='<select id="gfp_stripe_conditional_value" name="gfp_stripe_conditional_value" class="optin_select">';for(var s=0;s<o.choices.length;s++){var d=o.choices[s].value?o.choices[s].value:o.choices[s].text,l=d==t,_=l?"selected='selected'":"";l&&(n=!0),r+="<option value='"+d.replace(/'/g,"&#039;")+"' "+_+">"+TruncateMiddle(o.choices[s].text,i)+"</option>"}!n&&t&&(r+="<option value='"+t.replace(/'/g,"&#039;")+"' selected='selected'>"+TruncateMiddle(t,i)+"</option>"),r+="</select>"}else t=t?t.replace(/'/g,"&#039;"):"",r+="<input type='text' placeholder='"+stripe_edit_feed_settings.conditional_value_placeholder+"' id='gfp_stripe_conditional_value' name='gfp_stripe_conditional_value' value='"+t.replace(/'/g,"&#039;")+"'>";return r}function GetFieldById(e){for(var t=0;t<form.fields.length;t++)if(form.fields[t].id==e)return form.fields[t];return null}function TruncateMiddle(e,t){if(e.length<=t)return e;var i=parseInt(t/2);return e.substr(0,i)+"..."+e.substr(e.length-i,i)}function GetSelectableFields(e,t){for(var i,r="",o=0;o<form.fields.length;o++)if(fieldLabel=form.fields[o].adminLabel?form.fields[o].adminLabel:form.fields[o].label,fieldLabel="undefined"==typeof fieldLabel?"":fieldLabel,i=form.fields[o].inputType?form.fields[o].inputType:form.fields[o].type,IsConditionalLogicField(form.fields[o])){var n=form.fields[o].id==e?"selected='selected'":"";r+="<option value='"+form.fields[o].id+"' "+n+">"+TruncateMiddle(fieldLabel,t)+"</option>"}return r}function IsConditionalLogicField(e){inputType=e.inputType?e.inputType:e.type;var t=["checkbox","radio","select","text","website","textarea","email","hidden","number","phone","multiselect","post_title","post_tags","post_custom_field","post_content","post_excerpt","total"],i=jQuery.inArray(inputType,t);return i>=0}var form=stripe_edit_feed_settings.form;""===stripe_edit_feed_settings.new_feed&&jQuery(document).ready(function(){var e=stripe_edit_feed_settings.reg_condition_selected_field,t=stripe_edit_feed_settings.reg_condition_selected_value;SetStripeCondition(e,t)});